//Game object goes here.
var hangMan = {

  getRandomPokemon: function() {
    return this.pokemons[Math.floor(Math.random() * this.pokemons.length)];
  },
    
  setSelectedPokemon: function(getRandomPokemon) {
    this.selectedPokemon = getRandomPokemon;
    console.log(this.selectedPokemon)
    this.counts = {};
    this.selectedPokemon.split("").forEach(letter => {
    this.counts[letter] = this.counts[letter] ? this.counts[letter] + 1 : 1;
});
    console.log(this.counts)
  },
  getPlaceHolder: function() {
      let placeHolder = [];
      for (i = 0; i < this.selectedPokemon.length; i++) {
          if (i == this.selectedPokemon.length - 1) {
            placeHolder.push("_")
            return placeHolder
          } 
          placeHolder.push("_ ")
      }
      return placeHolder
  },
  setPlaceHolder: function(getPlaceHolder) {
    this.placeHolder = getPlaceHolder;
  },
  pokemons: ["BULBASAUR", "IVYSAUR", "VENUSAUR", "CHARMANDER", "CHARMELEON", "CHARIZARD", "SQUIRTLE", "WARTORTLE", "BLASTOISE", "CATERPIE", "METAPOD", "BUTTERFREE", "WEEDLE", "KAKUNA", "BEEDRILL", "PIDGEY", "PIDGEOTTO", "PIDGEOT", "RATTATA", "RATICATE", "SPEAROW", "FEAROW", "EKANS", "ARBOK", "PIKACHU", "RAICHU", "SANDSHREW", "SANDSLASH", "NIDORAN", "NIDORINA", "NIDOQUEEN", "NIDORAN", "NIDORINO", "NIDOKING", "CLEFAIRY", "CLEFABLE", "VULPIX", "NINETALES", "JIGGLYPUFF", "WIGGLYTUFF", "ZUBAT", "GOLBAT", "ODDISH", "GLOOM", "VILEPLUME", "PARAS", "PARASECT", "VENONAT", "VENOMOTH", "DIGLETT", "DUGTRIO", "MEOWTH", "PERSIAN", "PSYDUCK", "GOLDUCK", "MANKEY", "PRIMEAPE", "GROWLITHE", "ARCANINE", "POLIWAG", "POLIWHIRL", "POLIWRATH", "ABRA", "KADABRA", "ALAKAZAM", "MACHOP", "MACHOKE", "MACHAMP", "BELLSPROUT", "WEEPINBELL", "VICTREEBEL", "TENTACOOL", "TENTACRUEL", "GEODUDE", "GRAVELER", "GOLEM", "PONYTA", "RAPIDASH", "SLOWPOKE", "SLOWBRO", "MAGNEMITE", "MAGNETON", "FARFETCH'D", "DODUO", "DODRIO", "SEEL", "DEWGONG", "GRIMER", "MUK", "SHELLDER", "CLOYSTER", "GASTLY", "HAUNTER", "GENGAR", "ONIX", "DROWZEE", "HYPNO", "KRABBY", "KINGLER", "VOLTORB", "ELECTRODE", "EXEGGCUTE", "EXEGGUTOR", "CUBONE", "MAROWAK", "HITMONLEE", "HITMONCHAN", "LICKITUNG", "KOFFING", "WEEZING", "RHYHORN", "RHYDON", "CHANSEY", "TANGELA", "KANGASKHAN", "HORSEA", "SEADRA", "GOLDEEN", "SEAKING", "STARYU", "STARMIE", "MR. MIME", "SCYTHER", "JYNX", "ELECTABUZZ", "MAGMAR", "PINSIR", "TAUROS", "MAGIKARP", "GYARADOS", "LAPRAS", "DITTO", "EEVEE", "VAPOREON", "JOLTEON", "FLAREON", "PORYGON", "OMANYTE", "OMASTAR", "KABUTO", "KABUTOPS", "AERODACTYL", "SNORLAX", "ARTICUNO", "ZAPDOS", "MOLTRES", "DRATINI", "DRAGONAIR", "DRAGONITE", "MEWTWO", "MEW"],
  
  getGuessedCharacters: function() {
    if (typeof document.getElementById("div3").textContent != "undefined") {
      return document.getElementById("div3").textContent.replace("Guessed characters: ", "")
    }
  },
  setGuessedCharacters: function(guessCharacters) {
    console.log(guessCharacters)
    this.guessedCharacters = guessCharacters;
  },
  prepareScreen: function() {
      placeHolderDiv = document.createElement("div");
      placeHolderDiv.setAttribute("id", "div4");
      placeHolderContent = document.createTextNode(this.placeHolder.join(""));
      placeHolderDiv.appendChild(placeHolderContent);
      placeHolderCurrentDiv = document.getElementById("div1");
      document.body.insertBefore(placeHolderDiv, placeHolderCurrentDiv.nextSibling);
    
      guessDiv = document.createElement("div");
      guessDiv.setAttribute("id", "div3");
      guessContent = document.createTextNode("Guessed characters: ");
      guessDiv.appendChild(guessContent);
      guessContentCurrentDiv = document.getElementById("div2");
      document.body.insertBefore(guessDiv, guessContentCurrentDiv.nextSibling);
    },
  getGuess: function() {
    document.body.onkeyup = function(event) {
     if (hangMan.wrongGuessCount == 6 || hangMan.winState == true) {
      return
    }
     
      hangMan.setGuessedCharacters(hangMan.getGuessedCharacters());
      if (/^[a-zA-Z'.]+$/.test(String.fromCharCode(event.keyCode)) && !hangMan.guessedCharacters.includes(String.fromCharCode(event.keyCode))) {
      document.getElementById("div3").innerHTML += String.fromCharCode(event.keyCode);
      hangMan.setCurrentGuess(hangMan.getCurrentGuess(String.fromCharCode(event.keyCode)));
      hangMan.setGuessedCharacters(hangMan.getGuessedCharacters());
      hangMan.setPopulatePlaceHolder(hangMan.getPopulatePlaceHolder(hangMan.populatePlaceHolder()))
      hangMan.populatePlaceHolder();
      hangMan.checkWinLose();
      }
    }
  },
  populatePlaceHolder: function() {
    console.log(this.correctArray)
    if (this.selectedPokemon.toUpperCase().split("").includes(this.currentGuess)) {
        if (typeof this.correctArray == "undefined") {
        this.correctArray = this.selectedPokemon.toUpperCase().split("").map(function(letter) {if (letter != this.currentGuess) {
          return letter.replace(letter, "_")}});
        }
      for (let i=0; i<this.correctArray.length; i++) {
      if (this.selectedPokemon.toUpperCase().split("")[i] == this.currentGuess) {
        this.correctArray.splice(i, 1, this.currentGuess)
      }
    }
      let div4 = document.getElementById("div4");
      div4.innerHTML = this.correctArray.join(" ");
      return this.correctArray
  }
    return this.correctArray

  },
  setCurrentGuess: function(currentGuess) {
    this.currentGuess = currentGuess;
  },
  getCurrentGuess: function(keyInput) {
    return keyInput
  },
  getPopulatePlaceHolder: function(populatePlaceHolder) {
    return populatePlaceHolder
  },
  setPopulatePlaceHolder: function(correctArray) {
    this.correctArray = correctArray;
  },
  resetGame: function() {
    hangMan.setSelectedPokemon(hangMan.getRandomPokemon());
    hangMan.setPlaceHolder(hangMan.getPlaceHolder());
    delete this.correctArray;
    delete this.wrongGuessCount;
    hangMan.winState = false;
    let div3 = document.getElementById('div3');
    let div4 = document.getElementById('div4');
    let resetButton = document.getElementById("resetButton");
    let winMessage = document.getElementById("winMessage");
    div3.remove();
    div4.remove();
    if (resetButton != null) {
      resetButton.remove();
    }
    if (winMessage != null) {
      winMessage.remove();
    }
    
    hangMan.prepareScreen();

    
  },
  checkWinLose: function() {
    //counts object is populated with unique values from selected pokemon//
    console.log(hangMan.counts);
    this.uniqueLetters = Object.keys(hangMan.counts);
    console.log(this.uniqueLetters);
    console.log(hangMan.guessedCharacters.split(""));
    hangMan.setWrongGuessCount(hangMan.getWrongGuessCount(hangMan.compare(this.uniqueLetters, hangMan.guessedCharacters.split(""))));

    this.correctArrayObj = {};
    this.correctArray.forEach(letter => {
    this.correctArrayObj[letter] = this.correctArray[letter] ? this.correctArray[letter] + 1 : 1;
});

    console.log(hangMan.wrongGuessCount)
    if (hangMan.wrongGuessCount == 6) {
      //call fail game logic// 
      console.log("YOU LOST")
      hangMan.createResetButton();
    }
    if (JSON.stringify(Object.keys(hangMan.counts)) === JSON.stringify(Object.keys(hangMan.correctArrayObj))) {
      //call win game logic//
      console.log("YOU WON")
      hangMan.winState = true
      hangMan.createWinMessage();
      hangMan.createResetButton();
      
      
    }
    
  },
  wrongGuessCount:0,
  
  getWrongGuessCount: function(correctGuesses) {
    if (correctGuesses == 0) {
      return 1 + hangMan.wrongGuessCount;
    }
    return hangMan.guessedCharacters.length - correctGuesses.length;
  },
  setWrongGuessCount: function(correctGuessCount) {
    this.wrongGuessCount = correctGuessCount;
  },
  compare: function(arr1,arr2){
  
  const objMap={};
  
  arr1.forEach((e1)=>arr2.forEach((e2)=> {if(e1 === e2){
       objMap[e1]=objMap[e1]+1||1 ;
    }
  }
));
  console.log(Object.keys(objMap));
  return Object.keys(objMap);
},
  correctArray: [],
  
  winState: false,
  
  createResetButton: function() {
     resetButton = document.createElement("button");
     resetButton.setAttribute("id", "resetButton");
     resetButton.setAttribute("type", "button");
     resetButtonContent = document.createTextNode("Play Again");
     resetButton.appendChild(resetButtonContent);
     parentResetButtonDiv = document.getElementById("winMessage");
     document.body.insertBefore(resetButton, parentResetButtonDiv.nextSibling);

     resetButton.onclick = function() {
       hangMan.resetGame();
     }
     
  },
  createWinMessage: function() {
    winMessage = document.createElement("h3");
    winMessage.setAttribute("id", "winMessage")
    winMessageContent = document.createTextNode("You Win!");
    winMessage.appendChild(winMessageContent);
    parentWinMessageDiv = document.getElementById("div3");
    document.body.insertBefore(winMessage, parentWinMessageDiv.nextSibling);
  }


}
hangMan.setSelectedPokemon(hangMan.getRandomPokemon());
hangMan.setPlaceHolder(hangMan.getPlaceHolder());
hangMan.prepareScreen();
hangMan.resetGame();
hangMan.getGuess();
